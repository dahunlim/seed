var app=angular.module("app",["ngMessages","ngSanitize","ngAnimate","ui.router","app.controller","app.service","app.directive","app.constant","app.filter","aram.angular"]),controller=angular.module("app.controller",[]),service=angular.module("app.service",[]),directive=angular.module("app.directive",[]),constant=angular.module("app.constant",[]),filter=angular.module("app.filter",[]);app.run(["Session","Router","Login",function(e,t,r){e.initialize(["userID","userState"]),t.security(r.isLogined,"login")}]).config(["$stateProvider","$urlRouterProvider","$httpProvider",function(e,t,r){r.defaults.withCredentials=!0,e.state("login",{url:"/login",views:{"mainContainer@":{templateUrl:"./app/page/login/loginView.html",controller:"LoginCtrl as ctrl"}}}).state("container",{url:"",authenticate:!0,views:{"mainContainer@":{templateUrl:"./app/page/container.html"}}}).state("container.dashboard",{url:"/dashboard",authenticate:!0,views:{menuContentsContainer:{templateUrl:"./app/page/dashboard/dashboardView.html",controller:"DashboardCtrl as ctrl"}}}).state("container.homepage",{url:"/homepage","abstract":!0,authenticate:!0,views:{menuContentsContainer:{templateUrl:"./app/page/homepage/homepageContainer.html",controller:"BoardListCtrl as ctrl"}}}).state("container.homepage.board",{url:"/board",abtract:!0,authenticate:!0,views:{contentsContainer:{templateUrl:"./app/page/homepage/board/container.html"}}}).state("container.homepage.board.list",{url:"/list/:pageNumber",authenticate:!0,views:{boardContainer:{templateUrl:"./app/page/homepage/board/list/listView.html",controller:"BoardListCtrl as ctrl"}}}).state("container.homepage.board.detail",{url:"/detail/:articleID",authenticate:!0,views:{boardContainer:{templateUrl:"./app/page/homepage/board/detail/detailView.html",controller:"BoardDetailCtrl as ctrl"}}}).state("container.homepage.board.write",{url:"/write",authenticate:!0,views:{boardContainer:{templateUrl:"./app/page/homepage/board/write/writeView.html",controller:"BoardWriteCtrl as ctrl"}}}).state("container.homepage.board.modify",{url:"/modify/:articleID",authenticate:!0,views:{boardContainer:{templateUrl:"./app/page/homepage/board/modify/modifyView.html",controller:"BoardModifyCtrl as ctrl"}}}),t.otherwise("/dashboard")}]),constant.constant("SERVER_URL","http://localhost:3000"),constant.constant("SERVER_URL","http://api.aram-in.com"),filter.filter("example",function(){return function(e){}}),service.factory("Board",["Request",function(e){return{list:function(t,r,o){var n={offset:r,count:o};return t&&t.length>0&&(n.keyword=t),e.send("GET","/board/list",n)},get:function(t){return e.send("GET","/board/get",{articleID:t})},insert:function(t,r,o){var n={title:t,contents:r};return o&&(n.image=o),e.send("POST","/board/insert",n)},modify:function(t,r,o,n){var a={articleID:t,title:r,contents:o};return n&&(a.image=n),e.send("POST","/board/modify",a)},"delete":function(t){return e.send("GET","/board/delete",{articleID:t})}}}]),service.factory("Login",["Request",function(e){return{isLogined:function(){return e.send("GET","/login/isLogined",{})},email:function(t,r){return e.send("POST","/login/email",{userID:t,userPass:r})}}}]),service.factory("Logout",[function(){return{}}]),service.factory("Media",["Request","$q","$http",function(e,t,r){return{getSignedUploadUrl:function(){return e.send("GET","/media/getSignedUrl",{})},uploadToS3:function(e,o){var n=t.defer();return r({method:"PUT",url:e,data:o,headers:{"Content-Type":"image/jpeg"}}).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise}}}]),controller.controller("DashboardCtrl",[function(){console.log("Dashboard Controller is loaded!")}]),controller.controller("LoginCtrl",["Login","Response","Router",function(e,t,r){var o=this;o.user={id:"",pass:""},o.login=function(){0!=o.user.id.length&&0!=o.user.pass.length?e.email(o.user.id,o.user.pass).then(function(e){e.code==t.code.SUCCESS?r.go("container.dashboard"):alert("Login Fail")},t.networkError):alert("Input Login Information")}}]),directive.directive("directiveExample",[function(){return{restrict:"A",template:"<div>hello</div>",link:function(e,t,r){console.log("example directive call!")}}}]),controller.controller("BoardDetailCtrl",["$stateParams","Board","Response","Router",function(e,t,r,o){var n=this;t.get(e.articleID).then(function(e){switch(e.code){case r.code.SUCCESS:n.article=e.data;break;default:alert(e.msg),o.back()}},r.networkError),n.list=function(){o.go("container.homepage.board.list",{pageNumber:e.pageNumber})},n.modify=function(){o.go("container.homepage.board.modify",{articleID:e.articleID})},n["delete"]=function(){t["delete"](e.articleID).then(function(e){e.code==r.code.SUCCESS?o.go("container.homepage.board.list",{}):alert(e.msg)},r.networkError)}}]),controller.controller("BoardModifyCtrl",["$stateParams","$timeout","Board","Response","Router",function(e,t,r,o,n){var a=this;r.get(e.articleID).then(function(e){e.code==o.code.SUCCESS?(a.article=e.data,a.article.image=null,a.article.contents=$("#summernote").summernote("code",a.article.contents)):(alert(e.msg),n.back())},o.networkError),a.modify=function(){a.article.contents=$("#summernote").summernote("code"),r.modify(a.article._id,a.article.title,a.article.contents,a.article.image).then(function(e){e.code==o.code.SUCCESS?n.back():alert(e.msg)},o.networkError)},t(function(){$("#summernote").summernote({height:400,callbacks:{onImageUpload:function(e){for(var t=0;t<e.length;t++)!function(e){Media.getSignedUploadUrl().then(function(t){var r=t.data;Media.uploadToS3(r.url,e).then(function(e){var t=document.createElement("img");t.setAttribute("src","https://s3.ap-northeast-2.amazonaws.com/aramin-common/"+r.file),a.article.image=r.file,$("#summernote").summernote("insertNode",t)},o.networkError)},o.networkError)}(e[t])}}})})}]),controller.controller("BoardListCtrl",["$scope","Board","Response","$stateParams",function(e,t,r,o){var n=this;n.isSlideBtn=!0,n.slideBtnClick=function(){n.isSlideBtn=!n.isSlideBtn},n.page={number:"undefined"==typeof o.pageNumber||0==o.pageNumber.length?1:Number(o.pageNumber),count:15,keyword:"",articles:[]},n.page.offset=(n.page.number-1)*n.page.count,n.load=function(){t.list(n.page.keyword,n.page.offset,n.page.count).then(function(e){n.page.articles=e.data},r.networkError)},n.load()}]),controller.controller("BoardWriteCtrl",["$timeout","Media","Response","Board","Router",function(e,t,r,o,n){var a=this;a.article={title:"",contents:"",image:null},a.done=function(){a.article.contents=$("#summernote").summernote("code"),o.insert(a.article.title,a.article.contents,a.article.image).then(function(e){e.code==r.code.SUCCESS?n.go("container.homepage.board.list"):alert("등록에 실패하였습니다.")},r.networkError)},e(function(){$("#summernote").summernote({height:400,callbacks:{onImageUpload:function(e){for(var o=0;o<e.length;o++)!function(e){t.getSignedUploadUrl().then(function(o){var n=o.data;t.uploadToS3(n.url,e).then(function(e){var t=document.createElement("img");t.setAttribute("src","https://s3.ap-northeast-2.amazonaws.com/aramin-common/"+n.file),a.article.image=n.file,$("#summernote").summernote("insertNode",t)},r.networkError)},r.networkError)}(e[o])}}})})}]);